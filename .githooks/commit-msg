#!/bin/sh
# BookMan í”„ë¡œì íŠ¸ ì»¤ë°‹ ë©”ì‹œì§€ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

# ì»¤ë°‹ ë©”ì‹œì§€ ì½ê¸°
commit_msg=$(cat $1)

# ë¹ˆ ë¼ì¸ê³¼ ì£¼ì„ ì œê±°
commit_msg=$(echo "$commit_msg" | grep -v '^#' | grep -v '^$' | head -1)

# ê¸°ë³¸ í˜•ì‹ ê²€ì¦: <type>(<scope>): <subject>
commit_regex='^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\([a-z]+\))?: .{1,50}$'

if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
    echo "âŒ ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!"
    echo ""
    echo "ğŸ“ ì˜¬ë°”ë¥¸ í˜•ì‹:"
    echo "   <type>(<scope>): <subject>"
    echo ""
    echo "ğŸ“‹ ì˜ˆì‹œ:"
    echo "   feat(book): ë„ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€"
    echo "   fix(auth): ë¡œê·¸ì¸ í† í° ë§Œë£Œ ì²˜ë¦¬ ì˜¤ë¥˜ ìˆ˜ì •"
    echo "   docs(readme): ì„¤ì¹˜ ê°€ì´ë“œ ì—…ë°ì´íŠ¸"
    echo ""
    echo "ğŸ·ï¸  í—ˆìš©ë˜ëŠ” type:"
    echo "   feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert"
    echo ""
    echo "ğŸ¯ í—ˆìš©ë˜ëŠ” scope:"
    echo "   book, author, user, auth, search, admin, api, db, config, security"
    echo ""
    echo "ğŸ“ SubjectëŠ” 1-50ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤."
    echo ""
    exit 1
fi

# ì¶”ê°€ ê²€ì¦: í•œê¸€ ë˜ëŠ” ì˜ì–´ë§Œ í—ˆìš© (ì´ëª¨ì§€ ì œì™¸)
subject=$(echo "$commit_msg" | sed 's/^[^:]*: //')
if echo "$subject" | grep -q '[ğŸ˜€-ğŸ™ğŸŒ€-ğŸ—¿ğŸš€-ğŸ›¿]'; then
    echo "âš ï¸  ì»¤ë°‹ ë©”ì‹œì§€ì— ì´ëª¨ì§€ ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    echo "   ë” ëª…í™•í•˜ê³  ê²€ìƒ‰ ê°€ëŠ¥í•œ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”."
    echo ""
fi

# ì„±ê³µ ë©”ì‹œì§€
echo "âœ… ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤!"
exit 0
